@using EPMS.Models.Common
@model  EPMS.WebModels.ViewModels.RFI.RfiListViewModel
@{
    ViewBag.Title = EPMS.WebModels.Resources.RFI.RFI.ListPageTitle;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var direction = EPMS.WebModels.Resources.Shared.Common.TextDirection;
}


<div class="breadcrumb-container" dir="ltr">
    <ul class="xbreadcrumbs">
        <li>
            <a href="~/Dashboard/Index">
                <i class="icon-photon home"></i>
            </a>
        </li>
        <li class="current">
            <a href="~/Inventory/RFI/Index">
                @EPMS.WebModels.Resources.RFI.RFI.ListPageBreadCrumb
            </a>
        </li>
    </ul>
</div>

<header>
    <i class="icon-big-notepad"></i>
    <h2><small>@EPMS.WebModels.Resources.RFI.RFI.ListPageHeading</small></h2>
@if ((UserRole)Convert.ToInt32(Session["RoleKey"].ToString()) == UserRole.Employee)
{
    <h3><small><a href="~/Inventory/RFI/Create">@EPMS.WebModels.Resources.RFI.RFI.CreateRFILink</a></small></h3>
}
    
</header>

<!--Notifications begin-->
@Html.Partial("_Alert")
<!--Notifications end-->

<form class="form-horizontal">
    @Html.HiddenFor(model => model.SearchRequest.SearchString, new { id = "searchString" });
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <table id="dataTable" class="table table-striped table-responsive">
                    <thead class="cf sorthead">
                        @if ((UserRole)Convert.ToInt32(Session["RoleKey"].ToString()) == UserRole.InventoryManager)
                        {
                            <tr>
                                <th></th>
                                <th>@EPMS.WebModels.Resources.Shared.Common.Serial</th>
                                <th>@EPMS.WebModels.Resources.RFI.RFI.RfiNo</th>
                                <th>@EPMS.WebModels.Resources.RFI.RFI.Requester</th>
                                <th>@EPMS.WebModels.Resources.RFI.RFI.Date</th>
                                <th>@EPMS.WebModels.Resources.RFI.RFI.Status</th>
                            </tr>
                        }
                        else
                        {
                            <tr>
                                <th></th>
                                <th>@EPMS.WebModels.Resources.Shared.Common.Serial</th>
                                <th>@EPMS.WebModels.Resources.RFI.RFI.RfiNo</th>
                                <th>@EPMS.WebModels.Resources.RFI.RFI.Customer</th>
                                <th>@EPMS.WebModels.Resources.RFI.RFI.Date</th>
                                <th>@EPMS.WebModels.Resources.RFI.RFI.Status</th>
                            </tr>
                        }
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">
    $(document).ready(function () {
        var siteUrl = $('#siteURL').val();
        if ('@((UserRole)Convert.ToInt32(Session["RoleKey"].ToString()))' == '@(UserRole.InventoryManager)') {
            var oTable = $('#dataTable').dataTable({
                "bProcessing": true,
                "bServerSide": true,
                "sPaginationType": "bootstrap",
                "aoColumns": [
                    {
                        "aTargets": [0],
                        "sDefaultContent": "",
                        "bVisible": false,
                        "bSortable": false
                    },
                    {
                        "aTargets": [1],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            return full["RFIId"];
                        },
                        "bVisible": true,
                        "bSortable": false
                    },
                    {
                        "aTargets": [2],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            var val = full["FormNumber"];
                            var id = full["RFIId"];
                            var element = '<a href="History/' + id + '">' + val + '</a>';
                            return element;
                        }
                    },
                    {
                        "aTargets": [3],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            return full["RequesterName"];
                        }
                    },
                    {
                        "aTargets": [4],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            return full["RecCreatedDateString"];
                        }
                    },
                    {
                        "aTargets": [5],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            var value = "";
                            if (full["Status"] == 6) {
                                value = '@EPMS.WebModels.Resources.CMS.Order.Pending';
                            } else if (full["Status"] == 3) {
                                value = '@EPMS.WebModels.Resources.CMS.Order.Rejected';
                            }
                            else if (full["Status"] == 2) {
                                value = '@EPMS.WebModels.Resources.CMS.Order.Accepted';
                            }
                            return value;
                        },
                        "bSortable": true
                    }
                ],
                "fnServerParams": function (aoData) {
                    aoData.push({ "name": "search", "value": $('input').val() });
                },
                "sAjaxSource": siteUrl + "/Inventory/RFI/Index",
                "sServerMethod": "POST",
                "oLanguage": {
                    "sLoadingRecords": "Please wait - loading records...",
                    "sZeroRecords": "No records to display.",
                    "sProcessing": "Processing...",
                    "sInfoEmpty": "No entries to display."
                },
                "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                    $("td:first", nRow).html(iDisplayIndex + 1);
                    return nRow;
                },
            });
        } else {
            var oTable = $('#dataTable').dataTable({
                "bProcessing": true,
                "bServerSide": true,
                "sPaginationType": "bootstrap",
                "aoColumns": [
                    {
                        "aTargets": [0],
                        "sDefaultContent": "",
                        "bVisible": false,
                        "bSortable": false
                    },
                    {
                        "aTargets": [1],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            return full["RFIId"];
                        },
                        "bVisible": true,
                        "bSortable": false
                    },
                    {
                        "aTargets": [2],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            var val = full["FormNumber"];
                            var id = full["RFIId"];
                            var element = '<a href="Details/' + id + '">' + val + '</a>';
                            return element;
                        }
                    },
                    {
                        "aTargets": [3],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            return full["CustomerName"];
                        }
                    },
                    {
                        "aTargets": [4],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            return full["RecCreatedDateString"];
                        }
                    },
                    {
                        "aTargets": [5],
                        "sDefaultContent": "No Data",
                        "mRender": function (data, type, full) {
                            var value = "";
                            if (full["Status"] == 6) {
                                value = '@EPMS.WebModels.Resources.CMS.Order.Pending';
                            } else if (full["Status"] == 3) {
                                value = '@EPMS.WebModels.Resources.CMS.Order.Rejected';
                            }
                            else if (full["Status"] == 2) {
                                value = '@EPMS.WebModels.Resources.CMS.Order.Accepted';
                            }
                            return value;
                        },
                        "bSortable": true
                    }
                ],
                "fnServerParams": function (aoData) {
                    aoData.push({ "name": "search", "value": $('input').val() });
                },
                "sAjaxSource": siteUrl + "/Inventory/RFI/Index",
                "sServerMethod": "POST",
                "oLanguage": {
                    "sLoadingRecords": "Please wait - loading records...",
                    "sZeroRecords": "No records to display.",
                    "sProcessing": "Processing...",
                    "sInfoEmpty": "No entries to display."
                },
                "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                    $("td:first", nRow).html(iDisplayIndex + 1);
                    return nRow;
                },
            });
        }
        $(".dataTables_length select").select2({
            dropdownCssClass: 'noSearch'
        });
        $(".dataTables_filter input").unbind()
            .bind("input", function (e) {
                // Bind our desired behavior
                if (this.value.length >= 3 || e.keyCode == 13) {
                    $("#searchString").val(this.value);
                    //oTable.fnClearTable();
                    //$('#employeeTable').empty();
                    oTable.fnDraw();
                }
                if (this.value == "") {
                    $("#searchString").val(this.value);
                    oTable.fnDraw();
                }
                return;
            });
    });

    function validateForm() {
        var listSimple = $('.toBeRequired');
        var counter = 0;
        for (var i = 0; i < (listSimple.length) ; i++) {
            var control = listSimple[i];
            var fieldvalue = $(control).val();
            if (fieldvalue == null || fieldvalue == "") {
                $(control).prop('placeholder', 'Required');
                counter++;
                $(control).addClass("Error");

            } else {
                $(control).removeClass("Error");
            }

        }
        if (counter > 0) {
            //implementing focus back to error
            if ($(".Error").length > 0) {
                var divId = $(".Error")[0].id;
                if ($("#" + divId).length > 0)
                    $("#" + divId).focus();
                return false;
            }
        }
        return true;
    }
</script>