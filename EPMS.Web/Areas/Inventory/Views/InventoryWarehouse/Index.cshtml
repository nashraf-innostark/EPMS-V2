@model EPMS.WebModels.ViewModels.InventoryWarehouse.InventoryWarehouseListViewModel

@{
    ViewBag.Title = EPMS.WebModels.Resources.Inventory.InventoryWarehouse.PGTitleIndex;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var direction = EPMS.WebModels.Resources.Shared.Common.TextDirection;
    string[] userPermissionsSet = (string[])HttpContext.Current.Session["UserPermissionSet"];
    int i = 0;
}

<div class="breadcrumb-container">
    <ul class="xbreadcrumbs">
        <li>
            <a href="~/Dashboard/Index">
                <i class="icon-photon home"></i>
            </a>
        </li>
        <li class="current">
            <a href="javascript:;">@ViewBag.Title</a>
        </li>
    </ul>
</div>
<header>
    <i class="icon-big-notepad"></i>
    <h2><small>@ViewBag.Title</small></h2>
    @if (userPermissionsSet.Contains("InventoryWarehouseCreate"))
    {
        <h3><small><a href="~/Inventory/InventoryWarehouse/Create">@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.WarehouseCreate</a></small></h3>
    }
</header>
<!--Notifications begin-->
@Html.Partial("_Alert")
<!--Notifications end-->

<form class="form-horizontal">
    <div class="container-fluid">
        <!--Sortable Responsive Media Table begin-->
        <div class="row-fluid">
            <div class="span12">
                <table class="table table-striped table-responsive" id="tableSortableResMed">
                    <thead class="">
                        <tr>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.Serial</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.WarehouseNumber</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.WarehouseManager</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.WarehouseSize</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.IsFull</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.NumberOfAisles</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.NumberOfSections</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.NumberOfShalves</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.NumberOfSectionsOnShalves</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.NumberOfSpaces</th>
                            <th>@EPMS.WebModels.Resources.Inventory.InventoryItem.Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var warehouse in Model.Warehouses)
                        {
                            <tr class="gradeX">
                                <td>@( i += 1)</td>
                                <td> <a href="~/Inventory/InventoryWarehouse/Create/@warehouse.WarehouseId">@warehouse.WarehouseNumber</a></td>
                                @if (warehouse.WarehouseManager != null)
                                {
                                    if (direction == "ltr")
                                     {
                                         <td>@warehouse.EmployeeNameEn</td>
                                     }
                                     else
                                     {
                                         <td>@warehouse.EmployeeNameAr</td>
                                     }
                                }
                                else
                                {
                                    <td>@warehouse.ManagerName</td>
                                }
                                <td>@warehouse.WarehouseSize</td>
                                @if (warehouse.IsFull)
                                {
                                    <td>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.IsFullYes</td>
                                }
                                else
                                {
                                    <td>@EPMS.WebModels.Resources.Inventory.InventoryWarehouse.IsFullNo</td>
                                }
                                <td class="center">@warehouse.NoOfAisles</td>
                                <td class="center">@warehouse.NoOfSections</td>
                                <td class="center">@warehouse.NoOfShalves</td>
                                <td class="center">@warehouse.NoOfSectoinsInShalves</td>
                                <td class="center">@warehouse.NoOfSpaces</td>
                                <td class="@warehouse.WarehouseId"><a href="#" id="delete" onclick="deleteRow(@warehouse.WarehouseId)">@EPMS.WebModels.Resources.Inventory.InventoryItem.Delete</a></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</form>

<script>
    $(document).ready(function () {
        $('#tableSortableResMed').dataTable({
            "sPaginationType": "bootstrap",
            "fnInitComplete": function () {
                $(".dataTables_wrapper select").select2({
                    dropdownCssClass: 'noSearch'
                });
            }
        });
    });

    function deleteRow(warehouseId) {
        if (confirm("Are you sure you want to delete this row ?") == false) {
            return;
        }

        var serviceUrl = '/Inventory/InventoryWarehouse/Delete';
        $.ajax({
            url: serviceUrl,
            type: "POST",
            dataType: "json",
            data: {
                warehouseId: warehouseId
            },
            success: function (data) {
                if (data == "Deleted") {
                    $.pnotify({
                        title: 'Success',
                        type: 'success',
                        text: 'Record has been Deleted.'
                    });
                    var row = $("." + warehouseId).parent().get(0);
                    var atable = $('#tableSortableResMed').dataTable();
                    var pos = atable.fnGetPosition(row);
                    atable.fnDeleteRow(pos);
                } else {
                    $.pnotify({
                        title: 'Failure',
                        type: 'error',
                        text: 'Cannot delete, warehouse detail exists.'
                    });
                }
            },
        });
    }

</script>