@using System.Configuration
@using EPMS.Models.Common
@model EPMS.WebModels.ViewModels.Quotation.QuotationDetailViewModel
@{
    ViewBag.Title = EPMS.WebModels.Resources.CMS.Order.OrderDetail;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var direction = EPMS.WebModels.Resources.Shared.Common.TextDirection;
    var discount = Model.Quotation.QuotationDiscount;
    string date = Model.Quotation.RecCreatedDate.ToString();
    string[] str = date.Split(' ');
    date = str[0];
}

<!-- Navigation Bar -->
<div class="breadcrumb-container">
    <ul class="xbreadcrumbs">
        <li>
            <a href="~/Dashboard/Index">
                <i class="icon-photon home"></i>
            </a>
        </li>
        <li>
            <a href="~/CMS/Order/Index">
                @EPMS.WebModels.Resources.CMS.Order.PTIndex
            </a>
        </li>
        <li>
            @ViewBag.Title
        </li>
    </ul>
</div>
<!-- Page heading -->
<header>
    <i class="icon-big-notepad"></i>
    <h2><small>@ViewBag.Title</small></h2>
</header>

<!--Notifications begin-->
@Html.Partial("_Alert")
<!--Notifications end-->
<!-- Page heading ends -->
@using (Html.BeginForm("Detail", "Quotation", FormMethod.Post, new { @class = "form-horizontal", @id = "AddUpdateQuotationForm", role = "form", enctype = "multipart/form-data" }))
{
    <div class="container-fluid">
        @Html.HiddenFor(model => model.Quotation.QuotationId)
        @Html.HiddenFor(model => model.Quotation.CustomerId)
        <div class="control-group row-fluid">

            <div class="form-legend centTitle">
                @EPMS.WebModels.Resources.CMS.Order.CentTitle
            </div>
            <div class="invoice-info">
                <div class="invoice-name">
                    @if (direction == "ltr")
                    {
                        @Model.Profile.CompanyNameE
                    }
                    else
                    {
                        @Model.Profile.CompanyNameA
                    }
                </div>
                <div class="controls">
                    <a href="javascript:print()" rel="tooltip" title="" data-original-title="Print statistics" class="print"><i class="icon-print"></i> @EPMS.WebModels.Resources.CMS.Quotation.Print</a>
                </div>
                @if (!(string.IsNullOrEmpty(ViewBag.LogoPath)))
                {
                    <img class="employeeImg" src='@Url.Content(ViewBag.LogoPath)' alt="user" />
                }
                else
                {
                    <img class="employeeImg" alt="Logo" />
                }
                <div class="control-group row-fluid">
                    <div class="span3">
                        <div class="invoice-from">
                            <span>@EPMS.WebModels.Resources.CMS.Quotation.EmpName</span>
                            @Model.EmployeeName
                            <span>@EPMS.WebModels.Resources.CP.Profile.Name</span>
                            @Model.Profile.CompanyNameE
                            <address>
                                @EPMS.WebModels.Resources.CMS.Quotation.StreetAddress
                                @Model.Profile.CompanyAddressE <br />
                                <abbr title="Phone">@EPMS.WebModels.Resources.CMS.Quotation.Phone:</abbr> @Model.Profile.CompanyNumber <br>
                                <abbr title="Website">@EPMS.WebModels.Resources.CMS.Quotation.Website:</abbr> @Model.Profile.CompanyWebsite <br>
                                <abbr title="invoiceMail">@EPMS.WebModels.Resources.CMS.Quotation.Email:</abbr> @Model.Profile.CompanyEmail <br>
                            </address>
                        </div>
                    </div>

                    <div class="span3">
                        <div class="invoice-to">
                            <span>@EPMS.WebModels.Resources.CMS.Quotation.ClientName</span>
                            <strong>@Model.Quotation.Customers.CustomerNameE</strong>
                            <address>
                                @EPMS.WebModels.Resources.CMS.Quotation.StreetAddress
                                @Model.Quotation.Customers.CustomerAddress <br>
                                <abbr title="Phone">@EPMS.WebModels.Resources.CMS.Quotation.Phone:</abbr> @Model.Quotation.Customers.CustomerMobile <br>
                                <abbr title="Fax">@EPMS.WebModels.Resources.CMS.Quotation.Email:</abbr> @Model.Quotation.Customers.Email
                            </address>
                        </div>
                    </div>
                    <div class="span6">
                        <div class="invoice-infos">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>@EPMS.WebModels.Resources.CMS.Quotation.Date:</th>
                                        <td>@date</td>
                                    </tr>
                                    <tr>
                                        <th>@EPMS.WebModels.Resources.CMS.Order.CentTitle #:</th>
                                        <td>@Model.Quotation.OrderNo</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="control-group row-fluid">
                    <div class="span3">
                        <label class="control-label" for="GreetingEn">@EPMS.WebModels.Resources.CMS.Quotation.Greetings</label>
                    </div>
                    <div class="span9">
                        <div class="controls">
                            @Html.TextBoxFor(model => model.Quotation.GreetingsEn, new { @id = "GreetingEn", @class = "", @readonly = true })
                        </div>
                    </div>
                </div>
                <div class="control-group row-fluid">
                    <div class="span3">
                        <label class="control-label" for="GreetingAr">@EPMS.WebModels.Resources.CMS.Quotation.GreetingsAr</label>
                    </div>
                    <div class="span9">
                        <div class="controls">
                            @Html.TextBoxFor(model => model.Quotation.GreetingsAr, new { @id = "GreetingAr", @class = "", @readonly = true })
                        </div>
                    </div>
                </div>
                <div class="row-fluid" id="ress">
                    <div class="span12">
                        <table class="table table-striped table-responsive ">
                            <thead class="">
                                <tr>
                                    <th style="width:70%">@EPMS.WebModels.Resources.CMS.Quotation.ItemDetails</th>
                                    <th>@EPMS.WebModels.Resources.CMS.Quotation.Quantity</th>
                                    <th>@EPMS.WebModels.Resources.CMS.Quotation.UnitPrice</th>
                                    <th>@EPMS.WebModels.Resources.CMS.Quotation.Total</th>
                                </tr>
                            </thead>
                            <tbody class="qouteAdd">
                                @foreach (var itemDetail in Model.Quotation.QuotationItemDetails)
                                {
                                    <tr>
                                        <td>
                                            @itemDetail.ItemDetails
                                        </td>
                                        <td class="">
                                            @itemDetail.ItemQuantity
                                        </td>
                                        <td class="">
                                            @itemDetail.UnitPrice
                                        </td>
                                        <td class="total">
                                            @itemDetail.TotalPrice
                                        </td>
                                    </tr>
                                }
                                <tr class="invoiceCal">
                                    <td colspan="2"></td>
                                    <td class="sub">
                                        @EPMS.WebModels.Resources.CMS.Quotation.Subtotal :
                                    </td>
                                    <td id="subtotal">
                                        10
                                    </td>
                                </tr>
                                <tr class="invoiceCal">
                                    <td colspan="2"></td>
                                    <td class="disc">
                                        @EPMS.WebModels.Resources.CMS.Quotation.Discount :
                                    </td>
                                    <td id="Discount">
                                        @discount
                                    </td>
                                </tr>
                                <tr class="invoiceCal">
                                    <td colspan="2"></td>
                                    <td class="gTotal">
                                        @EPMS.WebModels.Resources.CMS.Quotation.GrandTotal :
                                    </td>
                                    <td id="GrandTotal">
                                        10
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="inWord">@EPMS.WebModels.Resources.CMS.Quotation.InWords</label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                <input id="inWord" type="text" name="numbers" value="0" class="newLine" disabled />
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-info alert-block">
                        <i class="icon-alert icon-alert-info"></i>
                        <strong><a>@EPMS.WebModels.Resources.CMS.Quotation.InstallmentPlan</a></strong>
                    </div>

                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="Installment1">@EPMS.WebModels.Resources.CMS.Quotation.FirstInstallment<a href="javascript:;" class="bootstrap-tooltip" data-placement="top" data-original-title="0-100"><i class="icon-photon info-circle"></i></a></label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                @Html.TextBoxFor(model => model.Quotation.FirstInstallement, new { @id = "Installment1", @class = "installer", @readonly = true })
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="DueAt1">@EPMS.WebModels.Resources.CMS.Quotation.DueAt<a href="javascript:;" class="bootstrap-tooltip" data-placement="top" data-original-title="0-100"><i class="icon-photon info-circle"></i></a></label>
                        </div>
                        <div class="span4 span-inset">
                            <div class="progress progress-info">
                                <div class="bar" style="width:@Model.Quotation.FirstInsDueAtCompletion%">@Model.Quotation.FirstInsDueAtCompletion%</div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="Installment2">@EPMS.WebModels.Resources.CMS.Quotation.SecondInstallment<a href="javascript:;" class="bootstrap-tooltip" data-placement="top" data-original-title="0-100"><i class="icon-photon info-circle"></i></a></label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                @Html.TextBoxFor(model => model.Quotation.SecondInstallment, new { @id = "Installment2", @class = "installer", @readonly = true })
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="DueAt2">@EPMS.WebModels.Resources.CMS.Quotation.DueAt<a href="javascript:;" class="bootstrap-tooltip" data-placement="top" data-original-title="0-100"><i class="icon-photon info-circle"></i></a></label>
                        </div>
                        <div class="span4 span-inset">
                            <div class="progress progress-info">
                                <div class="bar" style="width:@Model.Quotation.SecondInsDueAtCompletion%">@Model.Quotation.SecondInsDueAtCompletion%</div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="Installment3">@EPMS.WebModels.Resources.CMS.Quotation.ThirdInstallment<a href="javascript:;" class="bootstrap-tooltip" data-placement="top" data-original-title="0-100"><i class="icon-photon info-circle"></i></a></label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                @Html.TextBoxFor(model => model.Quotation.ThirdInstallment, new { @id = "Installment3", @class = "installer", @readonly = true })
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="DueAt3">@EPMS.WebModels.Resources.CMS.Quotation.DueAt<a href="javascript:;" class="bootstrap-tooltip" data-placement="top" data-original-title="0-100"><i class="icon-photon info-circle"></i></a></label>
                        </div>
                        <div class="span4 span-inset">
                            <div class="progress progress-info">
                                <div class="bar" style="width:@Model.Quotation.ThirdInsDueAtCompletion%">@Model.Quotation.ThirdInsDueAtCompletion%</div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="Installment4">@EPMS.WebModels.Resources.CMS.Quotation.FourthInstallment<a href="javascript:;" class="bootstrap-tooltip" data-placement="top" data-original-title="0-100"><i class="icon-photon info-circle"></i></a></label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                @Html.TextBoxFor(model => model.Quotation.FourthInstallment, new { @id = "Installment4", @class = "installer", @readonly = true })
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="DueAt4">@EPMS.WebModels.Resources.CMS.Quotation.DueAt<a href="javascript:;" class="bootstrap-tooltip" data-placement="top" data-original-title="0-100"><i class="icon-photon info-circle"></i></a></label>
                        </div>
                        <div class="span4 span-inset">
                            <div class="progress progress-info">
                                <div class="bar" style="width:@Model.Quotation.FourthInsDueAtCompletion%">@Model.Quotation.FourthInsDueAtCompletion%</div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="ExtraInformationEn">@EPMS.WebModels.Resources.CMS.Quotation.Notes</label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                @Html.TextBoxFor(model => model.Quotation.NotesEn, new { @id = "NotesEn", @class = "", @readonly = true })
                            </div>
                        </div>
                    </div>
                    <div class="control-group row-fluid">
                        <div class="span3">
                            <label class="control-label" for="ExtraInformationaAr">@EPMS.WebModels.Resources.CMS.Quotation.NotesAr</label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                @Html.TextBoxFor(model => model.Quotation.NotesAr, new { @id = "NotesAr", @class = "", @readonly = true })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<script type="text/javascript" src="~/Scripts/plugins/jquery.nToWord.js"></script>
<script>
    $(document).ready(function () {
        var x = 0;
        $('.qouteAdd tr').each(function () {

            if (!$(this).hasClass("invoiceCal")) {
                var y = parseInt($(this).find(".quantity").text()) * parseInt($(this).find(".unitPrice").text());
                x = x + parseInt($(this).find(".total").text());
            }
        });
        $('#subtotal').text(x);
        discount();
        function discount() {
            var subtotal = parseInt($('#subtotal').text());
            var Discount = parseInt($('#Discount').text());
            var grand = subtotal - (subtotal * (Discount / 100));
            $('#GrandTotal').text(grand);
            $('#inWord').val($.nToWord({ number: grand, language: "en" }));
        }
        var descpE = $("#NotesEn").val();
        var regex = /(<([^>]+)>)/ig;
        var result = descpE.replace(regex, "");
        $("#NotesEn").val(result);
        var descpA = $("#NotesAr").val();
        regex = /(<([^>]+)>)/ig;
        result = descpA.replace(regex, "");
        $("#NotesAr").val(result);
    });
</script>