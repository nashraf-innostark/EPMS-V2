@using iTextSharp.text.pdf.qrcode
@model EPMS.WebModels.ViewModels.RFQ.RFQDetailViewModel

@{
    ViewBag.Title = EPMS.WebModels.Resources.CMS.RFQ.Header;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var direction = EPMS.WebModels.Resources.Shared.Common.TextDirection;
    var discount = Model.Rfq.Discount ?? 0;
    string date = Model.Rfq.RecCreatedDate.ToString();
    string[] str = date.Split(' ');
    date = str[0];
    decimal subTotal = 0;
}

<!-- Navigation Bar -->
<div class="breadcrumb-container">
    <ul class="xbreadcrumbs">
        <li>
            <a href="~/Dashboard/Index">
                <i class="icon-photon home"></i>
            </a>
        </li>
        <li>
            <a href="~/CMS/Quotation/Index">
                @EPMS.WebModels.Resources.CMS.RFQ.PageTitleIndex
            </a>
        </li>
        <li>
            @ViewBag.Title
        </li>
    </ul>
</div>
<!-- Page heading -->
<header>
    <i class="icon-big-notepad"></i>
    <h2><small>@ViewBag.Title</small></h2>
</header>

<!--Notifications begin-->
@Html.Partial("_Alert")
<!--Notifications end-->
<!-- Page heading ends -->
@using (Html.BeginForm("RFQDetail", "Quotation", FormMethod.Post, new { @class = "form-horizontal", @id = "AddUpdateRFQ", role = "form", enctype = "multipart/form-data" }))
{
    <div class="container-fluid">
        <div class="control-group row-fluid">

            <div class="form-legend centTitle">
                @ViewBag.Title
            </div>
            <div class="invoice-info">
                <div class="invoice-name">
                    @if (direction == "ltr")
                    {
                        @Model.Profile.CompanyNameE
                    }
                    else
                    {
                        @Model.Profile.CompanyNameA
                    }
                </div>
                <div class="controls">
                    <a href="javascript:print()" rel="tooltip" title="" data-original-title="Print statistics" class="print"><i class="icon-print"></i> @EPMS.WebModels.Resources.CMS.Quotation.Print</a>
                </div>
                @if (!(string.IsNullOrEmpty(ViewBag.LogoPath)))
                {
                    <img class="employeeImg" src='@Url.Content(ViewBag.LogoPath)' alt="user" />
                }
                else
                {
                    <img class="employeeImg" alt="Logo" />
                }
                <div class="control-group row-fluid">
                    <div class="span3">
                        <div class="invoice-from">
                            <span>@EPMS.WebModels.Resources.CMS.RFQ.ClientName</span>
                            <strong>@(direction == "ltr" ? Model.Rfq.CustomerNameEn : Model.Rfq.CustomerNameAr)</strong>
                            <address>
                                @EPMS.WebModels.Resources.CMS.Quotation.StreetAddress:
                                @Model.Profile.CompanyAddressE <br />
                                <abbr title="Phone">@EPMS.WebModels.Resources.CMS.Quotation.Phone:</abbr> @Model.Profile.CompanyNumber <br>
                                <abbr title="invoiceMail">@EPMS.WebModels.Resources.CMS.Quotation.Email:</abbr> @Model.Profile.CompanyEmail <br>
                            </address>
                        </div>
                    </div>

                    <div class="span3">
                    </div>
                    <div class="span6">
                        <div class="invoice-infos">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>@EPMS.WebModels.Resources.CMS.Quotation.Date:</th>
                                        <td>@date</td>
                                    </tr>
                                    <tr>
                                        <th>@EPMS.WebModels.Resources.CMS.RFQ.RequestforQoutation #:</th>
                                        <td>123</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" id="ress">
                    <div class="span12">
                        <table class="table table-striped table-responsive ">
                            <thead class="">
                                <tr>
                                    <th style="width:70%">@EPMS.WebModels.Resources.CMS.Quotation.ItemDetails</th>
                                    <th>@EPMS.WebModels.Resources.CMS.Quotation.Quantity</th>
                                    <th>@EPMS.WebModels.Resources.CMS.Quotation.UnitPrice</th>
                                    <th>@EPMS.WebModels.Resources.CMS.Quotation.Total</th>
                                </tr>
                            </thead>
                            <tbody class="qouteAdd">
                                @foreach (var itemDetail in Model.Rfq.RFQItems)
                                {
                                    <tr>
                                        <td>
                                            @itemDetail.ItemDetails
                                        </td>
                                        <td class="">
                                            @itemDetail.ItemQuantity
                                        </td>
                                        <td class="">
                                            @itemDetail.UnitPrice
                                        </td>
                                        <td class="total">
                                            @itemDetail.TotalPrice

                                        </td>
                                    </tr>
                                    {
                                        subTotal = subTotal + itemDetail.TotalPrice;
                                    }
                                }
                                <tr class="invoiceCal">
                                    <td colspan="2"></td>
                                    <td class="sub">
                                        @EPMS.WebModels.Resources.CMS.Quotation.Subtotal :
                                    </td>
                                    <td id="subtotal">
                                        @subTotal
                                    </td>
                                </tr>
                                <tr class="invoiceCal">
                                    <td colspan="2"></td>
                                    <td class="disc">
                                        @EPMS.WebModels.Resources.CMS.Quotation.Discount :
                                    </td>
                                    <td id="Discount">
                                        @discount
                                    </td>
                                </tr>
                                <tr class="invoiceCal">
                                    <td colspan="2"></td>
                                    <td class="gTotal">
                                        @EPMS.WebModels.Resources.CMS.Quotation.GrandTotal :
                                    </td>
                                    <td id="GrandTotal">
                                        @(subTotal - ((subTotal * discount) / 100))
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="control-group row-fluid">
                    <div class="span3">
                        <label class="control-label" for="GreetingEn">@EPMS.WebModels.Resources.CMS.RFQ.Requests</label>
                    </div>
                    <div class="span9">
                        <div class="controls">
                            @Html.TextBoxFor(model => model.Rfq.Requests, new { @id = "Requests", @class = "", @readonly = true })
                        </div>
                    </div>
                </div>
                <div class="control-group row-fluid">
                    <div class="span3 span-inset">
                        <a href="~/CMS/Quotation/Create?from=Client&rfqId=@Model.Rfq.RFQId" class="btn">@EPMS.WebModels.Resources.CMS.RFQ.CreateQuotation</a>
                        @*<button type="submit" class="btn" onclick="">@EPMS.WebModels.Resources.CMS.RFQ.CreateQuotation</button>*@
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<script>
    $(document).ready(function () {
        var requests = '@Html.Raw(Model.Rfq.Requests)';
        var regex = /(<([^>]+)>)/ig;
        var result = requests.replace(regex, "");
        $("#Requests").val(result);
    });
</script>