@using EPMS.Models.Common
@model EPMS.WebModels.ViewModels.RFQ.RFQListViewModel

@{
    ViewBag.Title = EPMS.WebModels.Resources.CMS.RFQ.PageTitleIndex;
    Layout = "~/Views/Shared/_Layout.cshtml";
    string[] userPermissionsSet = (string[])HttpContext.Current.Session["UserPermissionSet"];
    var userRoleKey = (int)Session["RoleKey"];
    var direction = EPMS.WebModels.Resources.Shared.Common.TextDirection;
}

<!-- Navigation Bar -->
<div class="breadcrumb-container">
    <ul class="xbreadcrumbs">
        <li>
            <a href="~/Dashboard/Index">
                <i class="icon-photon home"></i>
            </a>
        </li>
        <li>
            @ViewBag.Title
        </li>
    </ul>
</div>
<!-- Page heading -->
<header>
    <i class="icon-big-notepad"></i>
    <h2><small>@ViewBag.Title</small></h2>
    @if (userPermissionsSet.Contains("RFQCreate"))
    {
        <h3> <small><a href="~/CMS/Quotation/RFQ">@EPMS.WebModels.Resources.CMS.RFQ.CreateRfq</a></small></h3>
    }
</header>

<!--Notifications begin-->
@Html.Partial("_Alert")
<!--Notifications end-->
<!-- Page heading ends -->

<form class="form-horizontal">
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <table id="RfqTable" class="table table-striped table-responsive">
                    @if (userRoleKey == 4)
                    {
                        int count = 1;
                        <thead>
                            <tr>
                                <th>@EPMS.WebModels.Resources.Shared.Common.Serial</th>
                                <th>@EPMS.WebModels.Resources.CMS.RFQ.Header</th>
                                <th>@EPMS.WebModels.Resources.CMS.RFQ.Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var rfq in Model.Rfqs)
                            {
                                <tr>
                                    <td>@count</td>
                                    @if (rfq.RFQItems.Any())
                                    {
                                        <td><a href="~/CMS/Quotation/RFQ/@rfq.RFQId?from=Client">@rfq.SerialNumber</a></td>
                                    }
                                    else
                                    {
                                        <td><a href="~/CMS/Quotation/RFQ/@rfq.RFQId">@rfq.SerialNumber</a></td>
                                    }
                                    <td>
                                        @{
                                            switch (rfq.Status)
                                            {
                                                case 1:
                                                    @:Qoutation Created
                                                                break;
                                                case 2:
                                                @:Pending
                                                                break;
                                            }
                                        }
                                    </td>
                                </tr>
                                count++;
                            }
                        </tbody>
                    }
                    else
                    {
                        int count = 1;
                        <thead>
                            <tr>
                                <th>@EPMS.WebModels.Resources.Shared.Common.Serial</th>
                                <th>@EPMS.WebModels.Resources.CMS.RFQ.Header</th>
                                <th>@EPMS.WebModels.Resources.CMS.RFQ.ClientName</th>
                                <th>@EPMS.WebModels.Resources.CMS.RFQ.Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var rfq in Model.Rfqs)
                            {
                                <tr>
                                    <td>@count</td>
                                    @if (rfq.RFQItems.Any())
                                    {
                                        <td><a href="~/CMS/Quotation/RFQDetail/@rfq.RFQId?from=Client">@rfq.SerialNumber</a></td>
                                    }
                                    else
                                    {
                                        <td><a href="~/CMS/Quotation/RFQDetail/@rfq.RFQId">@rfq.SerialNumber</a></td>
                                    }
                                    <td>@(direction == "ltr" ? rfq.CustomerNameEn : rfq.CustomerNameAr)</td>
                                    <td>
                                        @{
                                            switch ((RFQStatus)rfq.Status)
                                            {
                                                case RFQStatus.QoutationCreated:
                                                    @EPMS.WebModels.Resources.CMS.RFQ.QoutationCreated
                                                    break;
                                                case RFQStatus.Pending:
                                                    @EPMS.WebModels.Resources.CMS.RFQ.Pending
                                                    break;
                                            }
                                        }
                                    </td>
                                </tr>
                                count++;
                            }
                        </tbody>
                    }

                </table>
            </div>
        </div>
    </div>
</form>

<script>
    $(document).ready(function () {
        if ('@userRoleKey' == 4) {
            $('#RfqTable').dataTable({
                "sPaginationType": "bootstrap",
                "aoColumns": [
                    { "bVisible": true, "bSortable": false },
                      null,
                      null
                ],
                "fnInitComplete": function () {
                    $(".dataTables_wrapper select").select2({
                        dropdownCssClass: 'noSearch'
                    });
                },
                "oLanguage": {
                    "sProcessing": "Fetching record(s)",
                    //"sProcessing": "<img alt=\"Unread\" id=\"ajaxLoadImg\" src=\"/Images\/Gallery\/ajax_loader_red_512.gif\" />",
                    "sInfoEmpty": "No matching record(s) found",
                    "sEmptyTable": "No record(s) found",
                },
            });
        } else {
            $('#RfqTable').dataTable({
                "sPaginationType": "bootstrap",
                "aoColumns": [
                    { "bVisible": true, "bSortable": false },
                      null,
                      null,
                      null
                ],
                "fnInitComplete": function () {
                    $(".dataTables_wrapper select").select2({
                        dropdownCssClass: 'noSearch'
                    });
                },
                "oLanguage": {
                    "sProcessing": "Fetching record(s)",
                    //"sProcessing": "<img alt=\"Unread\" id=\"ajaxLoadImg\" src=\"/Images\/Gallery\/ajax_loader_red_512.gif\" />",
                    "sInfoEmpty": "No matching record(s) found",
                    "sEmptyTable": "No record(s) found",
                },
            });
        }
    });
</script>